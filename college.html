<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" /><link
  rel="stylesheet"
  href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css"
/>

  <title>Search College Events - Event Hub</title>
  <link rel="stylesheet" href="eventlist.css" />
  <link rel="stylesheet" href="search.css">
</head>
<body>
<a href="home.html" title="Home" class="home-icon">
  <i class="fas fa-home"></i>
</a>

  <h2>ğŸ“ Explore Vibrant College Events</h2>

  <div class="filters">
    <select id="collegeTypeFilter" onchange="filterEvents()">
      <option value="">ğŸ« All College Events</option>
      <option value="cultural fest">ğŸ¨ Cultural Fest</option>
      <option value="technical fest">ğŸ’» Technical Fest</option>
      <option value="sports meet">ğŸ… Sports Meet</option>
      <option value="freshers/graduation">ğŸ“ Freshers / Graduation</option>
    </select>

    <input type="text" id="locationFilter" placeholder="ğŸ“ Enter location..." onkeyup="filterEvents()" />
    <input type="date" id="dateFilter" onchange="filterEvents()" />
  </div>

  <div id="eventResults" class="event-grid"></div>

  <div id="animatedWelcome" class="welcome-wrapper">
    <div class="slideshow-container">
      <img id="slideImage" src="c1.jpg" alt="College Event" />
    </div>
    <div class="welcome-text">
      <h2 class="fade-in">Celebrate College Life ğŸ‰</h2>
      <p class="fade-in-delay">From fests to sports, explore thrilling college moments.</p>
    </div>
  </div>

  <script>
    let allEvents = [];

    async function fetchEvents() {
      try {
        const res = await fetch("http://localhost:8088/api/college");
        const data = await res.json();
        allEvents = data;
        filterEvents(); // Show welcome initially
      } catch (error) {
        console.error("Error fetching events:", error);
      }
    }

    function filterEvents() {
      const collegeType = document.getElementById("collegeTypeFilter").value.toLowerCase();
      const location = document.getElementById("locationFilter").value.toLowerCase();
      const date = document.getElementById("dateFilter").value;

      const hasFilters = collegeType || location || date;
      const welcome = document.getElementById("animatedWelcome");
      const results = document.getElementById("eventResults");

      if (!hasFilters) {
        welcome.classList.remove("hidden");
        results.classList.add("hidden");
        return;
      }

      const filtered = allEvents.filter(e =>
        e.type.toLowerCase() === "college" &&
        (collegeType === "" || (e.collegeType && e.collegeType.toLowerCase().includes(collegeType))) &&
        (location === "" || e.location.toLowerCase().includes(location)) &&
        (date === "" || e.date === date)
      );

      displayEvents(filtered);
    }

    function displayEvents(events) {
      const container = document.getElementById("eventResults");
      const welcome = document.getElementById("animatedWelcome");

      welcome.classList.add("hidden");
      container.classList.remove("hidden");
      container.innerHTML = "";

      if (events.length === 0) {
        container.innerHTML = "<p>No matching college events found.</p>";
        return;
      }

      events.forEach((e, index) => {
        const card = document.createElement("div");
        card.className = "event-card";
        card.style.animationDelay = `${index * 0.1}s`;

        card.innerHTML = `
          <p><strong>Type:</strong> ${e.type}${e.collegeType ? ` (${e.collegeType})` : ""}</p>
          <p><strong>Location:</strong> ${e.location}</p>
          <p><strong>Date:</strong> ${e.date}</p>
          <p><strong>Price:</strong> â‚¹${e.price}</p>
          <div class="card-buttons">
            <a href="booking.html" class="btn">Book Now</a>
            <button onclick='addToWishlist(${JSON.stringify(e)})' class="btn wishlist-btn">ğŸ’– Wishlist</button>
          </div>
        `;

        container.appendChild(card);
      });
    }

    async function addToWishlist(eventObj) {
      const userEmail = localStorage.getItem("userEmail");

      const payload = {
        ...eventObj,
        email: userEmail
      };

      try {
        const response = await fetch("http://localhost:8088/api/wishlist", {
          method: "POST",
          headers: {
            "Content-Type": "application/json"
          },
          body: JSON.stringify(payload)
        });

        if (response.ok) {
          alert("Event added to wishlist!");
        } else {
          alert("Failed to add to wishlist.");
        }
      } catch (error) {
        console.error("Error adding to wishlist:", error);
        alert("Error adding to wishlist.");
      }
    }

    // Slideshow
    const images = ["cc1.jpg", "cc2.jpg"];
    let current = 0;
    const slideImg = document.getElementById("slideImage");

    setInterval(() => {
      current = (current + 1) % images.length;
      slideImg.style.opacity = 0;
      setTimeout(() => {
        slideImg.src = images[current];
        slideImg.style.opacity = 1;
      }, 300);
    }, 2000);

    fetchEvents();
  </script>
</body>
</html>
