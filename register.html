<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Login & Register</title>
  <link rel="stylesheet" href="register.css" />
</head>
<body>
  <header>
    <h1>Event Management - User Access</h1>
  </header>
  <main class="auth-container">
    <div class="auth-tabs">
      <button onclick="showForm('login')" class="active">Login</button>
      <button onclick="showForm('register')">Register</button>
    </div>

    <!-- Login Form -->
    <div id="login-form" class="form-box">
      <h2>Login</h2>
      <form onsubmit="handleLogin(event)">
        <label for="login-email">Email:</label>
        <input type="email" id="login-email" required />

        <label for="login-password">Password:</label>
        <input type="password" id="login-password" required />

        <button type="submit" class="btn">Login</button>
      </form>
    </div>

<!-- Register Form -->
<div id="register-form" class="form-box hidden">
  <h2>Register</h2>
  <form onsubmit="handleRegister(event)">
    <label for="reg-name">Full Name:</label>
    <input type="text" id="reg-name" required />

    <label for="reg-email">Email:</label>
    <input type="email" id="reg-email" required />

    <label for="reg-password">Password:</label>
    <input type="password" id="reg-password" required />

    <label for="reg-role">Role:</label>
    <select id="reg-role" required>
      <option value="ROLE_USER">User</option>
      <option value="ROLE_ADMIN">Admin</option>
    </select>
<label for="reg-phone">Phone:</label>
<input type="text" id="reg-phone" required />

<label for="reg-city">City:</label>
<input type="text" id="reg-city" required />


    <button type="submit" class="btn">Register</button>
  </form>
</div>

  </main>

  <footer></footer>

  <script>
  // Toggle between login and register forms
  function showForm(formId) {
    ['login-form', 'register-form'].forEach(id => {
      document.getElementById(id).classList.add('hidden');
    });
    document.querySelectorAll('.auth-tabs button').forEach(btn => btn.classList.remove('active'));
    const activeTab = document.querySelector(`.auth-tabs button[onclick="showForm('${formId}')"]`);
    if (activeTab) activeTab.classList.add('active');
    document.getElementById(formId + '-form').classList.remove('hidden');
  }

  // Handle Login
function handleLogin(e) {
  e.preventDefault();

  const loginData = {
    email: document.getElementById("login-email").value.trim(),
    password: document.getElementById("login-password").value
  };

  fetch("http://localhost:8088/api/auth/login", {
    method: "POST",
    headers: {
      "Content-Type": "application/json"
    },
    body: JSON.stringify(loginData)
  })
  .then(response => {
    if (!response.ok) {
      return response.text().then(text => { throw new Error(text); });
    }
    return response.json();
  })
  .then(data => {
    alert("Login successful!");
    
    // Save user info
    localStorage.setItem("userEmail", data.email);
    localStorage.setItem("userRole", data.role);
    if (data.token) {
      localStorage.setItem("authToken", data.token);
    }

    // Redirect based on role
    if (data.role === "ROLE_ADMIN") {
      window.location.href = "admin.html";
    } else {
      window.location.href = "home.html";
    }
  })
  .catch(err => {
    if (err instanceof TypeError) {
      alert("Cannot connect to server.");
    } else {
      alert("Login failed: " + err.message);
    }
  });
}


  // Handle Registration
  function handleRegister(e) {
    e.preventDefault();

    const user = {
      fullName: document.getElementById('reg-name').value.trim(),
      email: document.getElementById('reg-email').value.trim(),
      password: document.getElementById('reg-password').value,
      role: document.getElementById('reg-role').value,
       phone: document.getElementById('reg-phone').value,
  city: document.getElementById('reg-city').value
    };

    fetch("http://localhost:8088/api/auth/register", {
      method: "POST",
      headers: {
        "Content-Type": "application/json"
      },
      body: JSON.stringify(user)
    })
    .then(response => {
      if (!response.ok) {
        return response.text().then(text => { throw new Error(text); });
      }
      return response.text();
    })
    .then(msg => {
      alert(msg);
      showForm('login');
    })
    .catch(err => {
      alert("Registration failed: " + err.message);
    });
    

  }
</script>

  </body>
  </html>