<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Admin - Manage Events</title>
  <style>
    body { font-family: sans-serif; padding: 20px; }
    table { width: 100%; border-collapse: collapse; margin-top: 20px; }
    th, td { padding: 10px; border: 1px solid #ccc; text-align: left; }
    form input { margin: 5px; padding: 8px; width: 200px; }
    button { padding: 6px 12px; margin-right: 5px; }
    .edit-btn { background: orange; color: white; }
    .delete-btn { background: red; color: white; }
  </style>
</head>
<body>

  <h2>Event Management</h2>

  <form id="eventForm">
    <input type="text" id="name" placeholder="Event Name" required />
    <input type="text" id="type" placeholder="Type (e.g., marriage)" required />
    <input type="text" id="date" placeholder="Date (YYYY-MM-DD)" required />
    <input type="text" id="location" placeholder="Location" required />
    <input type="number" id="price" placeholder="Price" required />
    <button type="submit">Add / Update Event</button>
  </form>

  <table id="eventTable">
    <thead>
      <tr>
        <th>Name</th><th>Type</th><th>Date</th><th>Location</th><th>Price</th><th>Actions</th>
      </tr>
    </thead>
    <tbody></tbody>
  </table>

  <script>
    let editEventId = null;

    async function fetchEvents() {
      const res = await fetch("http://localhost:8088/api/events");
      const events = await res.json();
      const tbody = document.querySelector("#eventTable tbody");
      tbody.innerHTML = "";

      events.forEach(e => {
        const row = document.createElement("tr");
        row.innerHTML = `
          <td>${e.name}</td>
          <td>${e.type}</td>
          <td>${e.date}</td>
          <td>${e.location}</td>
          <td>${e.price}</td>
          <td>
            <button class="edit-btn" onclick='editEvent(${JSON.stringify(e)})'>Edit</button>
            <button class="delete-btn" onclick='deleteEvent(${e.id})'>Delete</button>
          </td>
        `;
        tbody.appendChild(row);
      });
    }

    async function deleteEvent(id) {
      if (confirm("Are you sure you want to delete this event?")) {
        await fetch(`http://localhost:8088/api/events/${id}`, { method: "DELETE" });
        fetchEvents();
      }
    }

    function editEvent(e) {
      editEventId = e.id;
      document.getElementById("name").value = e.name;
      document.getElementById("type").value = e.type;
      document.getElementById("date").value = e.date;
      document.getElementById("location").value = e.location;
      document.getElementById("price").value = e.price;
    }

    document.getElementById("eventForm").addEventListener("submit", async e => {
      e.preventDefault();
      const event = {
        name: document.getElementById("name").value.trim(),
        type: document.getElementById("type").value.trim(),
        date: document.getElementById("date").value.trim(),
        location: document.getElementById("location").value.trim(),
        price: parseFloat(document.getElementById("price").value.trim())
      };

      const url = editEventId
        ? `http://localhost:8088/api/events/${editEventId}`
        : `http://localhost:8088/api/events`;
      const method = editEventId ? "PUT" : "POST";

      await fetch(url, {
        method,
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(event)
      });

      editEventId = null;
      e.target.reset();
      fetchEvents();
    });

    // Initial load
    fetchEvents();
  </script>

</body>
</html>
